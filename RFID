#include <SPI.h>
#include <MFRC522.h>
#include <string.h>
#define SS_PIN 10
#define RST_PIN 3
int first_card_price=10000;
int first_card_chk=0;
#define bus_price 1000
MFRC522 rfid(SS_PIN, RST_PIN); // Instance of the class

MFRC522::MIFARE_Key key; 
String first_card="533993a9";
void setup() { 
  Serial.begin(9600); //pc - 아두이노
  SPI.begin(); // Init SPI bus
  rfid.PCD_Init(); // Init MFRC522 
}
 
void loop() {

  //특정 조건 아니면 실행 안시키기
  // Reset the loop if no new card present on the sensor/reader. This saves the entire process when idle.
  if ( ! rfid.PICC_IsNewCardPresent())
    return;
  // Verify if the NUID has been readed
  if ( ! rfid.PICC_ReadCardSerial())
    return;

String output;
for(int i=0;i<4;i++)
{
  output+=String(rfid.uid.uidByte[i],HEX);
}
//1번 카드가 찍혔을때 버스비 계산
if(output.equals(first_card))
{
  //버스를 탈때
  if(first_card_chk==0)
  {
     //잔액이 부족할때
    if(first_card_price<1000)
    {
      Serial.println("잔액이 부족합니다.");
      delay(1000);
      return;
    }
    //잔액이 충분할때
    else
    {
      first_card_price=first_card_price-bus_price;
      Serial.print(first_card_price);
      Serial.println("원 남았습니다."); 
      //탑승했다chk
      first_card_chk=1;
    } 
  }
  else
  {
    Serial.println("하차합니다.");
    first_card_chk=0;
  }
}
else
{
  Serial.println("등록되지 않은 카드입니다.");
}
/* 끝나는 코드 */
  // Halt PICC
  rfid.PICC_HaltA();

  // Stop encryption on PCD
  rfid.PCD_StopCrypto1();

 
}
